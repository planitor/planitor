import{a as e,m as t,v as n,h as s,y as a,c as o,M as l,p as r}from"./vendor-05c4d753.js";function i(){return{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}}const d={logInGetToken(t,n){const s=new URLSearchParams;return s.append("username",t),s.append("password",n),e.post("/notendur/login/access-token",s)},getMe:()=>e.get("/notendur/me",i()),passwordRecovery:t=>e.post("/notendur/password-recovery/"+t),resetPassword:(t,n)=>e.post("/notendur/reset-password",{new_password:t,token:n}),logout:()=>e.get("/notendur/logout"),followCase:t=>e.post("/api/follow/cases/"+t,null,i()),unfollowCase:t=>e.delete("/api/follow/cases/"+t,i()),followAddress:t=>e.post("/api/follow/addresses/"+t,null,i()),unfollowAddress:t=>e.delete("/api/follow/addresses/"+t,i()),getEntityAddresses:t=>e.get(`/api/entities/${t}/addresses`),getNearbyAddresses:(t,n,s)=>e.get(`/api/addresses/${t}/addresses?radius=${n}&days=${s}`),getSubscriptions:()=>e.get("/api/subscriptions",i()),updateSubscription:(t,n)=>e.post("/api/subscriptions/"+t,n,i()),deleteSubscription:t=>e.delete("/api/subscriptions/"+t,i())},c=e=>e.filter(e=>e).join(" "),u=e=>{const{onSuccess:s,setScreen:a}=e,[o,l]=t({value:"",isDirty:!1,errors:[]}),[r,i]=t({value:"",isDirty:!1,errors:[]}),[u,m]=t({isLoading:!1,error:null});return n("div",null,n("h1",{class:"text-center text-2xl"},"Innskráning"),n("div",{class:"pt-6 pb-2 my-2"},n("form",{onSubmit:e=>{e.preventDefault(),m({isLoading:!0,error:null}),d.logInGetToken(o.value,r.value).then(e=>{localStorage.setItem("token",e.data.access_token),s()}).catch((function(e){[l,i].forEach(e=>{e(e=>({...e,errors:[],isDirty:!1}))});const t=e.response.data.detail;let n=null;"string"==typeof t&&(n=t),Array.isArray(t)&&t.forEach(e=>{const{loc:t,msg:n,type:s}=e,a={"value_error.missing":!0}[s];if(void 0===a)return;const o=t[t.length-1],r={username:l,password:i}[o];void 0!==r&&r(e=>({...e,errors:[a]}))}),m({isLoading:!1,error:n})}))}},u.error&&n("div",{class:"mb-4 text-red-700 font-bold"},u.error),n("div",{class:"mb-4"},n("label",{class:"block text-sm font-bold mb-2",for:"username"},"Netfang"),n("input",{class:c(["shadow appearance-none border rounded w-full py-2 px-3",o.isDirty||!o.errors.length?"":"error"]),name:"username",type:"text",disabled:u.isLoading,value:o.value,onInput:e=>{const{value:t}=e.target;l(e=>({...e,value:t,isDirty:!0}))}}),o.errors.map(e=>n("div",{class:"text-red-700 text-sm my-2"},e))),n("div",{class:"mb-6"},n("label",{class:"block text-sm font-bold mb-2",for:"password"},"Lykilorð"),n("input",{class:c(["shadow appearance-none border rounded w-full py-2 px-3 mb-3",r.isDirty||!r.errors.length?"":"error"]),name:"password",type:"password",disabled:u.isLoading,value:r.value,onInput:e=>{const{value:t}=e.target;i(e=>({...e,value:t,isDirty:!0}))}}),r.errors.map(e=>n("div",{class:"text-red-700 text-sm my-2"},e))),n("div",{class:"block sm:flex items-center justify-between"},n("div",null,n("button",{class:"btn-primary",type:"submit",disabled:u.isLoading},"Innskrá")),n("div",{class:"mt-4 sm:mt-0"},n("button",{onClick:e=>{e.stopPropagation(),a(["password-recovery",o.value])},class:"no-underline"},"Gleymt lykilorð?"))))))},m=({setScreen:e,emailDefaultValue:s})=>{const[a,o]=t({isLoading:!1,isSuccess:!1,error:null}),[l,r]=t({value:s,isDirty:!1});return n("div",null,n("h1",{class:"text-center text-2xl"},"Sækja um nýtt lykilorð"),n("div",{class:"pt-6 pb-2 my-2"},n("form",{onSubmit:e=>{e.preventDefault(),o({isLoading:!0,isSuccess:!1,error:null}),d.passwordRecovery(l.value).then(e=>{o({isLoading:!1,error:null,isSuccess:!0})}).catch((function(e){r(e=>({...e,isDirty:!1}));let t=e.response.data.detail||"Óþekkt villa á vefþjóni";o({isLoading:!1,isSuccess:!1,error:t})}))}},a.error&&n("div",{class:"mb-4 text-red-700 font-bold"},a.error),a.isSuccess&&n("div",{class:"mb-4 text-green-600 font-bold"},"Tölvupóstur með leiðbeiningum var sendur á ",l.value),n("div",{class:"mb-4"},n("label",{class:"block text-sm font-bold mb-2",for:"email"},"Netfang"),n("input",{class:"shadow appearance-none border rounded w-full py-2 px-3",name:"email",type:"text",disabled:a.isLoading||a.isSuccess,value:l.value,onInput:e=>{const{value:t}=e.target;r({value:t,isDirty:!0})}})),n("div",{class:"block md:flex items-center justify-between"},n("div",null,n("button",{class:"btn-primary",type:"submit",disabled:a.isLoading||a.isSuccess},"Senda")),n("div",{class:"mt-4 md:mt-0"},n("button",{onClick:t=>{t.stopPropagation(),e(["login",l.value])},class:"no-underline"},"Til baka"))))))},g=e=>{const{onSuccess:s}=e,[[a,o],l]=t(["login",""]);return n("div",null,n({login:u,"password-recovery":m}[a],{setScreen:l,emailDefaultValue:o,onSuccess:s}))},p=()=>{const e=document.getElementById("modal");e.classList.remove("hidden");const t=()=>{e.classList.add("hidden")};return window.addEventListener("click",e=>{!e.target.closest("#modal .inner")&&t()}),e.querySelectorAll(".close").forEach(e=>{e.addEventListener("click",e=>{t()})}),[e.querySelector(".form"),t]},f=e=>n("svg",{class:"inline h-5 w-5",width:"112px",height:"112px",viewBox:"0 0 112 112"},n("g",{transform:"translate(-622.000000, -48.000000)","fill-rule":"nonzero"},n("path",{d:"M726.662109,159.421875 C730.470703,159.421875 733.166016,156.492188 733.166016,152.742188 C733.166016,150.984375 732.580078,149.34375 731.291016,148.054688 L703.693359,120.398438 C709.494141,112.78125 712.951172,103.347656 712.951172,93.09375 C712.951172,68.3085938 692.677734,48.0351562 667.892578,48.0351562 C643.107422,48.0351562 622.833984,68.3085938 622.833984,93.09375 C622.833984,117.878906 643.107422,138.152344 667.892578,138.152344 C677.677734,138.152344 686.701172,134.988281 694.083984,129.714844 L721.857422,157.488281 C723.146484,158.777344 724.845703,159.421875 726.662109,159.421875 Z M667.892578,128.425781 C648.556641,128.425781 632.560547,112.429688 632.560547,93.09375 C632.560547,73.7578125 648.556641,57.7617188 667.892578,57.7617188 C687.228516,57.7617188 703.224609,73.7578125 703.224609,93.09375 C703.224609,112.429688 687.228516,128.425781 667.892578,128.425781 Z"}))),v=e=>n("svg",{width:"112px",height:"112px",class:"inline h-5 w-5",viewBox:"0 0 112 112"},n("g",{transform:"translate(-628.000000, -53.000000)","fill-rule":"nonzero"},n("path",{d:"M677.529297,104.109375 C690.068359,104.109375 700.966797,92.859375 700.966797,78.2109375 C700.966797,63.7382812 690.068359,53.015625 677.529297,53.015625 C664.990234,53.015625 654.091797,63.9726562 654.091797,78.328125 C654.091797,92.859375 664.931641,104.109375 677.529297,104.109375 Z M714.267578,158.367188 C723.525391,158.367188 726.806641,155.730469 726.806641,150.574219 C726.806641,135.457031 707.880859,114.597656 677.470703,114.597656 C647.119141,114.597656 628.193359,135.457031 628.193359,150.574219 C628.193359,155.730469 631.474609,158.367188 640.673828,158.367188 L714.267578,158.367188 Z"}))),h=e=>n("svg",{width:"100px",height:"113px",class:"inline h-5 w-5",viewBox:"0 0 100 113"},n("g",{"fill-rule":"nonzero"},n("path",{d:"M25.4649 113H74.5868C80.9917 113 84.8657 109.441 85.124 103.046L88.4298 27.6956H96.1777C98.2955 27.6956 100 25.8905 100 23.7759C100 21.6613 98.2955 19.9078 96.1777 19.9078H72.624V12.1716C72.624 4.74487 67.6136 0 59.6591 0H40.3409C32.3864 0 27.4277 4.74487 27.4277 12.1716V19.9078H3.82231C1.7562 19.9078 0 21.7129 0 23.7759C0 25.8905 1.7562 27.6956 3.82231 27.6956H11.6736L14.9793 103.046C15.2376 109.441 19.0599 113 25.4649 113ZM35.6921 19.9078V12.6874C35.6921 9.7476 37.8099 7.68462 40.9607 7.68462H59.0909C62.2417 7.68462 64.4112 9.7476 64.4112 12.6874V19.9078H35.6921ZM28.4607 95.0005L26.1364 38.7841C26.0331 36.618 27.5826 35.0192 29.5455 35.0192C31.3533 35.0192 32.9029 36.7211 33.0062 38.7841L35.124 95.0005C35.1756 97.115 33.7293 98.817 31.7149 98.817C29.8554 98.817 28.5124 97.2697 28.4607 95.0005ZM46.5393 95.0005L46.4876 38.7841C46.4876 36.7211 48.1405 35.0192 50 35.0192C51.9112 35.0192 53.564 36.7211 53.564 38.7841V95.0005C53.564 97.115 51.8595 98.817 50 98.817C48.1405 98.817 46.5393 97.115 46.5393 95.0005ZM64.9793 95.0005L67.0971 38.7841C67.1488 36.7211 68.6983 35.0192 70.5578 35.0192C72.469 35.0192 74.0186 36.618 73.9669 38.7841L71.6426 95.0005C71.5909 97.2697 70.1963 98.817 68.2851 98.817C66.3223 98.817 64.9277 97.115 64.9793 95.0005Z"}))),b=e=>n("a",{onClick:e=>{e.stopPropagation(),e.preventDefault(),d.logout().then(e=>{localStorage.removeItem("token"),location.reload()})},href:"/notendur/logout",role:"button",class:"text-sm font-bold text-powder-light"},"Útskrá"),w=e=>{const{onLogin:t}=e;return n("a",{href:"#",role:"button",onClick:e=>{e.stopPropagation(),e.preventDefault();const[s,a]=p();l(n(g,{onSuccess:()=>{t(),a()}}),s)},class:"block p-2"},n(v,null))},y=e=>{const[s,a]=t(document._user);return s?n("div",{class:"flex flex-row sm:flex-col"},n("div",null,n("a",{href:"/notendur/stillingar",class:"text-sm block truncate"},n("span",{class:"sm:hidden inline-block pl-4",style:"position: relative; top: 2px;"},n(v,null)),n("span",{class:"hidden sm:inline"},s.email))),n("div",{class:"order-first sm:order-last flex-grow"},n(b,null))):n(w,{onLogin:()=>{d.getMe().then(e=>{a(e.data),document._user=e.data}).catch((function(e){console.log(e)}))}})},x=()=>{const[e,l]=t("string"==typeof document._searchQuery),[r,i]=t(document._searchQuery),d=s(null);return a(()=>{d.current&&d.current.value&&d.current.focus()},[e]),n("div",{class:"flex justify-between items-center align-middle h-12"},n("div",{class:o("sm:order-2 sm:flex-grow text-center sm:px-10 sm:max-w-4xl",{"flex-grow":e})},!e&&n("span",{onClick:()=>{l(!0)},role:"button",class:"sm:hidden block"},n(f,null)),n("div",{class:o("sm:flex pr-4 sm:pr-0",{hidden:!e})},n("form",{class:"search flex bg-white bg-opacity-25 rounded-md items-center mr-3 px-3 w-full",method:"GET",action:"/leit"},n(f,null),n("input",{value:r,ref:d,onChange:e=>{i(e.target.value)},name:"q",size:"1",class:"bg-transparent flex-grow py-2 px-2 text-sm font-thin overflow-hidden focus:outline-none",placeholder:"Leit - t.d. 'Reitir ehf.', 'Brautarholt' eða 'gistiheimili'"})))),n("div",{class:o("flex-grow sm:order-1 sm:flex-grow-0 text-center",{hidden:e,"sm:block":e})},n("a",{href:"/s",class:"font-black text-lg sm:text-xl"},"Planitor")),n("div",{class:"order-last text-right"},n(y,null)))},k=({value:e,onChange:t,isDisabled:s,children:a})=>n("div",{class:"inline-block relative text-sm lg:text-base"},n("select",{value:e,onChange:t,disabled:s,class:"block appearance-none w-full border border-gray-400 hover:border-gray-500 px-1 lg:px-4 py-1 lg:py-2 pr-8 mr-3 rounded shadow leading-tight focus:outline-none focus:shadow-outline"},a),n("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},n("svg",{class:"fill-current h-4 w-4",viewBox:"0 0 20 20"},n("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})))),C=()=>n("div",{class:"rounded-lg shadow-sm p-4 w-full bg-white mb-4"},n("div",{class:"animate-pulse flex flex-row"},n("div",{class:"bg-gray-400 rounded w-3/4 mr-4 h-8"}),n("div",{class:"bg-gray-400 rounded w-1/4 mr-4 h-8"}),n("div",{class:"bg-gray-400 rounded w-16 h-8"}))),L=({serial:e,id:t})=>n("a",{href:"/cases/"+t},e),S=({search_query:e})=>n("a",{href:"/leit?q="+e},"„",e,"“"),E=({name:e,hnitnum:t,radius:s,onChangeRadius:a})=>n("a",{href:"/heimilisfong/"+t},e),A=({kennitala:e,name:t})=>n("a",{href:"/f/"+e},t),M=e=>{const{subscription:s}=e,[a,o]=t(!1),[l,i]=t(!1),[c,u]=t(s),{id:m,active:g,immediate:p}=c;let f=p?"immediate":"weekly";if(g||(f="never"),l)return null;return n("div",{class:"sm:rounded-lg sm:shadow-sm pb-2 sm:p-4 w-full sm:bg-white mb-2 sm:mb-4"},n("div",{class:"flex flex-col md:flex-row align-middle"},n("div",{class:"mr-4 flex-grow font-bold sm:text-lg whitespace-no-wrap flex items-center mb-1 sm:mb-0"},c.case&&n(L,c.case),c.search_query&&n(S,{search_query:c.search_query}),c.address&&n(E,c.address),c.entity&&n(A,c.entity)),n("div",null,n("div",{class:"flex justify-end sm:justify-between items-center w-full sm:w-auto"},c.address&&n("div",{class:"mr-2 sm:mr-4"},n(k,{value:c.radius||0,onChange:async e=>{const{value:t}=e.target,n=await d.updateSubscription(m,{radius:Number(t)}).then(e=>e.data);o(!1),u(n)},isDisabled:a},n(r,null,n("option",{value:0},"0m"),n("option",{value:100},"+ 100m"),n("option",{value:300},"+ 300m"),n("option",{value:500},"+ 500m")))),n(k,{value:f,onChange:async e=>{const{value:t}=e.target,n={active:"never"!==t,immediate:"immediate"===t};o(!0);const s=await d.updateSubscription(m,n).then(e=>e.data);o(!1),u(s)},isDisabled:a},n(r,null,n("option",{value:"never"},"Afvirkja"),n("option",{value:"immediate"},"Strax"),n("option",{value:"weekly"},"Vikuleg"))),n("button",{class:"ml-3 sm:ml-6 text-gray-500 flex-grow sm:flex-grow-0 flex justify-end",onClick:e=>{!a&&(async e=>{if(!confirm("Ertu viss um að þú viljir fjárlægja þennan vaktara?"))return;o(!0),await d.deleteSubscription(m).then(e=>e.data),i(!0)})()}},n(h,null))))))},D=()=>{const[e,s]=t([]);return a(async()=>{const e=await d.getSubscriptions().then(e=>e.data);s(e)},[]),e.length?n("div",null,e.map(e=>n(M,{key:e.id,subscription:e}))):n("div",null,n(C,null),n(C,null),n(C,null))},I=e=>{const{loading:t,onClick:s,hover:a,setHover:l,following:r,defaultLabel:i}=e;return n("button",{class:o("px-4 py-2 border rounded-lg font-bold sm:inline block mx-auto",{"text-gray-500 border-gray-500":t,"bg-midnight text-white":r&&!t,"text-midnight":!r&&!t,"border-midnight":!t}),onClick:s,onMouseOver:e=>{l(!0)},onMouseOut:e=>{l(!1)}},a?r?"Afvakta":i||"Vakta":r?"Vaktað":i||"Vakta")},j=e=>n("p",{class:"text-center"},"Vaktarinn stendur öllum til boða gegn mánaðargjaldi. ",n("br",null),"Til að fá aðgang sendu okkur línu á ",n(()=>n("a",{class:"text-midnight underline",href:"mailto:hallo@planitor.io"},"hallo@planitor.io"),null),"."),q=e=>{const{id:s,state:a,defaultLabel:o}=e,[r,i]=t(!1),[c,u]=t("following"===a),[m,g]=t({isLoading:!1,error:null});return n(I,{loading:m.isLoading,following:c,hover:r,setHover:i,onClick:e=>{if(e.preventDefault(),e.stopPropagation(),m.isLoading)return;if(null===document._user){const[e,t]=p();l(n(j,null),e)}else g({isLoading:!0,error:null}),(c?d.unfollowCase(s):d.followCase(s)).then(e=>{u(!c),i(!1),g({isLoading:!1,error:null})}).catch((function(e){g({isLoading:!1,error:e})}))},defaultLabel:o})},B=e=>{const{hnitnum:s,state:a}=e,[o,r]=t(!1),[i,c]=t("following"===a),[u,m]=t({isLoading:!1,error:null});return n(I,{loading:u.isLoading,following:i,hover:o,setHover:r,onClick:e=>{if(e.preventDefault(),e.stopPropagation(),u.isLoading)return;if(null===document._user){const[e,t]=p();l(n(j,null),e)}else m({isLoading:!0,error:null}),(i?d.unfollowAddress(s):d.followAddress(s)).then(e=>{c(!i),r(!1),m({isLoading:!1,error:null})}).catch((function(e){m({isLoading:!1,error:e})}))}})},_=({token:e})=>{const[s,a]=t({isSuccess:!1,isLoading:!1,error:null}),[o,l]=t("");return n("div",null,n("h1",{class:"text-center text-2xl"},"Nýtt lykilorð"),n("div",{class:"py-2 my-2"}),n("form",{onSubmit:t=>{t.preventDefault(),a({isLoading:!0,isSuccess:!1,error:null}),d.resetPassword(o,e).then(e=>{(e=>{localStorage.setItem("token",e)})(e.data.access_token),a({isLoading:!1,error:null,isSuccess:!0})}).catch((function(e){let t=e.response.data.detail||"Óþekkt villa á vefþjóni";a({isLoading:!1,isSuccess:!1,error:t})}))}},s.error&&n("div",{class:"mb-4 text-red-700 font-bold"},s.error),s.isSuccess&&n("div",{class:"mb-4 text-green-600 font-bold"},"Lykilorðið hefur verið uppfært."),n("div",{class:"mb-4"},n("input",{class:"shadow appearance-none border rounded w-full py-2 px-3",name:"password",type:"password",disabled:s.isLoading||s.isSuccess,value:o.value,onInput:e=>{l(e.target.value)}})),n("div",{class:"block md:flex items-center justify-between"},n("div",null,n("button",{class:"btn-primary",type:"submit",disabled:s.isLoading||s.isSuccess},"Vista")))))};let V=window.mapkit;function H(e){var t=e[0].lat,n=t,s=e[0].lon,a=s;if(1===e.length)return new V.CoordinateRegion(new V.Coordinate(t,s),new V.CoordinateSpan(.01,.01));for(var o of e){const{lat:e,lon:l}=o;e>t&&(t=e),e<n&&(n=e),l<s&&(s=l),l>a&&(a=l)}const l=.1*Math.abs(t-n),r=.1*Math.abs(a-s);return new V.BoundingRegion(t+l,a+r,n-l,s-r).toCoordinateRegion()}function P(e){var t=[];for(var n of e){const{lat:e,lon:s,label:a,status:o}=n,l=o?o[2]:null;t.push(new V.MarkerAnnotation(new V.Coordinate(e,s),{title:a,color:{green:"#48BB78",yellow:"#F6E05E",red:"#E53E3E"}[l]||"#718096"}))}return t}document.addEventListener("lazybeforeunveil",(function(e){let t=e.target;if(t.classList.contains("map")){var n=new V.Coordinate(parseFloat(t.dataset.lat),parseFloat(t.dataset.lon)),s=new V.CoordinateRegion(n,new V.CoordinateSpan(.03,.04)),a=new V.Map(t),o=new V.MarkerAnnotation(n,{color:"#f4a56d",title:t.dataset.address});a.showItems([o]),a.region=s}})),V.init({authorizationCallback:e=>{fetch("/mapkit-token").then(e=>e.text()).then(t=>e(t)).catch(e=>{console.error(e)})}});const z=document.getElementById("password-recovery");if(z){const[e,t]=p();l(n(_,{token:z.dataset.token}),e)}const R=document.getElementById("navigation");R&&l(n(x,null),R);const Z=document.getElementById("subscriptions");Z&&l(n(D,null),Z),V.addEventListener("configuration-change",(function(e){"Initialized"===e.status&&([...document.querySelectorAll(".entity-map")].forEach(async e=>{const t=await async function(e){const t=await d.getEntityAddresses(e).then(e=>e.data.addresses);return 0===t.length?null:{annotations:P(t),region:H(t)}}(e.dataset.kennitala);console.log(e,t),t&&new V.Map(e,t)}),[...document.querySelectorAll(".nearby-map")].forEach(async e=>{const t=await async function({hnitnum:e,radius:t,days:n}){const{address:s,addresses:a}=await d.getNearbyAddresses(e,t,n).then(e=>e.data);if(0===a.length)return null;const o=P(a),l=H(a);return o.push(new V.MarkerAnnotation(new V.Coordinate(s.lat,s.lon),{title:s.label,color:"#2A1F6F"})),{annotations:o,region:l}}(e.dataset);console.log(e,t),t&&new V.Map(e,t)}))})),[...document.querySelectorAll(".follow-case")].forEach(e=>{const t=e.innerText;e.innerHTML="",l(n(q,{id:e.dataset.id,state:e.dataset.state,defaultLabel:t}),e)}),[...document.querySelectorAll(".follow-address")].forEach(e=>{l(n(B,{hnitnum:e.dataset.hnitnum,state:e.dataset.state}),e)}),[...document.querySelectorAll(".tabs")].forEach(e=>{const t=e.parentElement.querySelectorAll(".tabPage"),n=e.querySelectorAll("button");[...n].forEach(e=>{const s=document.getElementById(e.dataset.target);e.addEventListener("click",a=>{t.forEach(e=>{e.classList.add("hidden")}),n.forEach(e=>{e.classList.remove("selected")}),e.classList.add("selected"),s.classList.remove("hidden")})})});
//# sourceMappingURL=index-a802673f.js.map
