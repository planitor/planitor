{% from "includes/breadcrumbs.html" import breadcrumbs, breadcrumb %}

{% macro meeting_card() %}
  {% set meeting_url = url_for('get_meeting', muni_slug = municipality.slug, council_slug = council.council_type.value.slug, meeting_id = h.encode(meeting.id)) %}
  <div class="rounded-md p-4 bg-powder-light text-powder-darker">
    <div class="flex justify-between items-start mb-2">
      <div>
        <div class="text-lg font-extrabold">
          Fundur
          <a href="{{ meeting_url }}" class="underline font-semibold"> nr. {{ meeting.name }}</a>
        </div>
        <div class="text-sm">{{ human_date(meeting.start) }}</div>
      </div>
      <div class="pill pill-big pill-{{ minute.status.value.color if minute.status else 'none' }} font-bold shadow-lg">
        {{ minute.status.value.label if minute.status else "Annað" }}
      </div>
    </div>
  </div>
{% endmacro %}

{% extends "case.html" %}

{% block title %}Bókun {{ minute.serial }} / {{ case.council.name }} í {{ municipality.name }} — {{ super.super() }}{% endblock %}
{% block og_title %}Bókun {{ minute.serial }} / {{ case.council.name }} í {{ municipality.name }} — {{ super.super() }}{% endblock %}

{% set council_slug = council.council_type.value.slug %}

{% block breadcrumbs %}
  {% call breadcrumbs() %}
    {{ breadcrumb(url_for('get_municipality', muni_slug=municipality.slug), municipality.name, dash=False) }}
    {{ breadcrumb(url_for('get_council', muni_slug=municipality.slug, council_slug=council_slug), council.name) }}
    {{ breadcrumb(url_for('get_case', muni_slug=municipality.slug, council_slug=council_slug, case_id=case.serial), case.serial) }}
    {{ breadcrumb(None, minute.serial, mobile_collapse=True) }}
  {% endcall %}
{% endblock %}

{% block inner %}
  <div class="mb-6">{{ meeting_card() }}</div>
  <div class="p-4 bg-white rounded-md shadow-lg">
    <div>
      <h5 class="uppercase tracking-wide text-gray-700 font-thin text-xs">Fyrirspurn</h5>
      <div>
        {% for kennitala, token in minute.get_inquiry_mention_tokens() -%}
          {% if not kennitala -%}
            {{ token.replace('\n\n', '<br />')|safe }}
          {% else -%}
            {% if kennitala.is_person() -%}
              <a class="text-blue-900 underline" href="{{ url_for('get_person', kennitala=kennitala.kennitala) }}">{{ token }}</a>
            {% else -%}
              <a class="text-blue-900 underline" href="{{ url_for('get_company', kennitala=kennitala.kennitala) }}">{{ token }}</a>
            {% endif -%}
          {% endif -%}
        {% endfor -%}
      </div>
    </div>
    {% if minute.remarks %}
    <div class="mt-4">
      <h5 class="uppercase tracking-wide text-gray-700 font-thin text-xs">Svar</h5>
      <p>{{ minute.remarks.replace('\n\n', '<br />')|safe }}</p>
    </div>
    {% endif %}
    {% if minute.attachments %}
    <div class="mt-4">
      <h5 class="uppercase tracking-wide text-gray-700 font-thin text-xs">Fylgigögn</h5>
      <ul class="list-disc ml-4 text-sm">
      {% for attachment in minute.attachments %}
        <li class="text-gray-800">
          <a class="hover:underline text-midnight" target="_blank" href="{{ attachment.url }}">{{ attachment.label }}</a>
          <span class="text-gray-400 ml-2">{{ {'application/pdf': 'PDF'}.get(attachment.type, '') }}</span>
        </li>
      {% endfor %}
      </ul>
    </div>
    {% endif %}
    {% if minute.participants %}
    <div class="mt-4">
      <h5 class="uppercase tracking-wide text-gray-700 font-thin text-xs">Gestir</h5>
      <ul class="text-sm">
      {% for participant in minute.participants %}
        <li class="text-gray-800">{{ participant }}</li>
      {% endfor %}
      </ul>
    </div>
    {% endif %}
    {% if minute.entrants_and_leavers %}
    <div class="mt-4">
      <h5 class="uppercase tracking-wide text-gray-700 font-thin text-xs">Komur og brottfarir</h5>
      <ul class="text-sm">
      {% for _ in minute.entrants_and_leavers %}
        <li class="text-gray-800">{{ _ }}</li>
      {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
  {% if minute.responses %}
  <div class="mt-6 p-4 bg-white rounded-md shadow-lg">
    <div>
      <h5 class="uppercase tracking-wide text-gray-700 font-thin text-xs">Gagnbókanir</h5>
      <ul>
      {% for response in minute.responses|sort(attribute="order") %}
        <li class="mt-2">
          <div class="font-bold">{{ ", ".join(response.subjects) or response.headline }}</div>
          <div class="">{{ response.contents }}</div>
        </li>
      {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}

{% endblock %}